<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ“Š Dashboard Sensor IoT</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Roboto', sans-serif;
  margin: 0;
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #333;
}
h1 { text-align: center; color: white; margin-bottom: 30px; text-shadow: 0 2px 5px rgba(0,0,0,0.3); }
.stats { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-bottom: 30px; }
.card {
  flex: 1 1 150px;
  background: white;
  border-radius: 15px;
  padding: 20px;
  min-width: 150px;
  text-align: center;
  box-shadow: 0 10px 20px rgba(0,0,0,0.15);
  transition: transform 0.3s, box-shadow 0.3s;
}
.card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0,0,0,0.2); }
.card h3 { font-size: 16px; margin-bottom: 10px; color: #666; text-transform: uppercase; }
.card p { font-size: 28px; font-weight: 700; margin: 0; }
.card.max { color: #ff6b6b; }
.card.min { color: #4ecdc4; }
.card.avg { color: #ffd93d; }
table { width: 100%; border-collapse: collapse; border-radius: 12px; overflow: hidden; background: white; box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
th, td { padding: 12px 15px; text-align: center; }
th { background: linear-gradient(90deg, #667eea, #764ba2); color: white; font-weight: 700; }
tbody tr:hover { background: #f0f0f5; transform: scale(1.02); transition: transform 0.2s; }
.loading, .empty-state { text-align: center; padding: 20px; color: #666; font-size: 16px; }
@media (max-width: 768px) { .stats { flex-direction: column; align-items: center; } }
</style>
</head>
<body>
<h1>ðŸ“Š Dashboard Sensor IoT</h1>

<div class="stats">
  <div class="card max">
    <h3>Suhu Maksimal</h3>
    <p id="maxTemp">-- Â°C</p>
  </div>
  <div class="card min">
    <h3>Suhu Minimum</h3>
    <p id="minTemp">-- Â°C</p>
  </div>
  <div class="card avg">
    <h3>Suhu Rata-rata</h3>
    <p id="avgTemp">-- Â°C</p>
  </div>
</div>

<table>
  <thead>
    <tr>
      <th>No</th>
      <th>Suhu (Â°C)</th>
      <th>Humidity (%)</th>
      <th>Kecerahan</th>
      <th>Timestamp</th>
    </tr>
  </thead>
  <tbody id="tableBody">
    <tr><td colspan="5" class="loading">Loading...</td></tr>
  </tbody>
</table>

<script>
async function loadData() {
  try {
    const res = await fetch("/data");
    const json = await res.json();
    const tbody = document.getElementById("tableBody");

    if (!json.data || json.data.length === 0) {
      tbody.innerHTML = `<tr><td colspan="5" class="empty-state">Belum ada data sensor</td></tr>`;
      document.getElementById("maxTemp").textContent = "-- Â°C";
      document.getElementById("minTemp").textContent = "-- Â°C";
      document.getElementById("avgTemp").textContent = "-- Â°C";
      return;
    }

    // Update stats
    document.getElementById("maxTemp").textContent = json.summary.suhu_max + " Â°C";
    document.getElementById("minTemp").textContent = json.summary.suhu_min + " Â°C";
    document.getElementById("avgTemp").textContent = json.summary.suhu_avg + " Â°C";

    // Update table - reverse data so newest is first
    tbody.innerHTML = "";
    json.data.reverse();
    json.data.forEach((d,index)=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${index+1}</td>
        <td>${d.suhu}</td>
        <td>${d.humid}</td>
        <td>${d.kecerahan}</td>
        <td>${new Date(d.timestamp).toLocaleString('id-ID')}</td>
      `;
      tbody.appendChild(tr);
    });

  } catch (err) {
    console.error("Error load data:", err);
    tbody.innerHTML = `<tr><td colspan="5" class="empty-state">Gagal memuat data</td></tr>`;
  }
}

loadData();
setInterval(loadData, 5000);
</script>
</body>
</html>
